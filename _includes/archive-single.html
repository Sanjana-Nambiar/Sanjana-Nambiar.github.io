{% include base_path %}

{%- comment -%}
Card layout for Projects/Publications/Awards (works across collections).
Front‑matter it expects (all optional):
- header.teaser: image path or full URL
- link: external link for the title
- timeline: "Jan 2024 – Apr 2024" (projects)
- venue: "ICLR 2025" (publications)
- github_repo: "https://github.com/..."
- paperurl, slidesurl, arxivurl: links for publications
- tags: [Python, Spark]  (shown as small chips)
{%- endcomment -%}

{%- assign teaser = nil -%}
{%- if post.header and post.header.teaser -%}
  {%- assign teaser = post.header.teaser -%}
{%- elsif site.teaser -%}
  {%- assign teaser = site.teaser -%}
{%- endif -%}

{%- assign title = post.title -%}
{%- if post.id -%}
  {%- assign title = post.title | markdownify | remove: "<p>" | remove: "</p>" -%}
{%- endif -%}

<div class="card">
  <div class="card__media">
    {%- if teaser -%}
      <img
        src="{% if teaser contains '://' %}{{ teaser }}{% else %}{{ teaser | prepend: '/images/' | prepend: base_path }}{% endif %}"
        alt="{{ title | strip_html }}">
    {%- else -%}
      <div class="card__placeholder">No image yet</div>
    {%- endif -%}
  </div>

  <div class="card__body">

    <h3 class="card__title">
      {%- if post.link -%}
        <a href="{{ post.link }}" target="_blank" rel="noopener">{{ title }}</a>
        <a href="{{ base_path }}{{ post.url }}" rel="permalink" class="card__permalink" aria-label="Permalink">↗</a>
      {%- else -%}
        <a href="{{ base_path }}{{ post.url }}" rel="permalink">{{ title }}</a>
      {%- endif -%}
    </h3>

    {%- comment -%} META LINE VARIES BY COLLECTION {%- endcomment -%}
    <div class="card__meta">
      {%- if post.collection == 'projects' and post.timeline -%}
        <span><i class="fa fa-calendar" aria-hidden="true"></i> {{ post.timeline }}</span>
      {%- endif -%}

      {%- if post.collection == 'publications' and post.venue -%}
        <span><i class="fa fa-university" aria-hidden="true"></i> {{ post.venue }}</span>
      {%- endif -%}

      {%- if post.read_time -%}
        <span><i class="fa fa-clock-o" aria-hidden="true"></i> {% include read-time.html %}</span>
      {%- endif -%}
    </div>

    {%- if post.excerpt -%}
      <p class="card__desc">{{ post.excerpt | markdownify | strip_html }}</p>
    {%- endif -%}

    {%- assign has_badge_row = false -%}
    {%- if post.github_repo or post.timeline or post.paperurl or post.slidesurl or post.arxivurl or post.tags -%}
      {%- assign has_badge_row = true -%}
    {%- endif -%}

    {%- if has_badge_row -%}
      <div class="card__badges">

        {%- if post.github_repo -%}
          <a class="card__badge" href="{{ post.github_repo }}" target="_blank" rel="noopener">
            <i class="fab fa-github" aria-hidden="true"></i> Code
          </a>
        {%- endif -%}
        {%- if post.slides -%}
          <a class="card__badge" href="{{ post.slides }}" target="_blank" rel="noopener">Slides</a>
        {%- endif -%}

        {%- if post.paper -%}
          <a class="card__badge" href="{{ post.paper }}" target="_blank" rel="noopener">Paper</a>
        {%- endif -%}

        {%- if post.collection == 'publications' -%}
          {%- if post.paperurl -%}
            <a class="card__badge" href="{{ post.paperurl }}" target="_blank" rel="noopener">Paper</a>
          {%- endif -%}

          {%- if post.dataseturl -%}
            <a class="card__badge" href="{{ post.dataseturl }}" target="_blank" rel="noopener">Dataset</a>
          {%- endif -%}
          {%- if post.codeurl -%}
            <a class="card__badge" href="{{ post.codeurl }}" target="_blank" rel="noopener">Code</a>
          {%- endif -%}
          {%- if post.slidesurl -%}
            <a class="card__badge" href="{{ post.slidesurl }}" target="_blank" rel="noopener">Slides</a>
          {%- endif -%}
        {%- endif -%}

        {%- if post.tags and post.tags.size > 0 -%}
          {%- for t in post.tags -%}
            <span class="card__chip">{{ t }}</span>
          {%- endfor -%}
        {%- endif -%}

      </div>
    {%- endif -%}

  </div>
</div>
